<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- Head -->
<head>

    <title>用户中心</title>

    <!-- Meta-Tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="keywords"
          content="Custom Signup Form Responsive, Login Form Web Template, Flat Pricing Tables, Flat Drop-Downs, Sign-Up Web Templates, Flat Web Templates, Login Sign-up Responsive Web Template, Smartphone Compatible Web Template, Free Web Designs for Nokia, Samsung, LG, Sony Ericsson, Motorola Web Design">
    <script type="application/x-javascript"> addEventListener("load", function () {
        setTimeout(hideURLbar, 0);
    }, false);

    function hideURLbar() {
        window.scrollTo(0, 1);
    } </script>
    <!-- //Meta-Tags -->

    <!-- Custom-Style-Sheet -->
    <!-- Index-Page-CSS -->
    <link rel="stylesheet" th:href="@{/css/style2.css}" type="text/css" media="all">
    <!-- Calendar-CSS -->
    <link rel="stylesheet" th:href="@{/css/jquery-ui.css}" type="text/css" media="all">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" type="text/css">

    <!-- Fonts -->
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" type="text/css" media="all">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700" type="text/css" media="all">
    <!-- //Fonts -->

    <link th:href="@{/img/washing.png}" rel="shortcut icon" type="image/x-icon">
</head>

<style>
    . btn {
        display: inline-block;
        width: 75px;
        height: 25px;
        overflow: hidden;
        text-align: center;
        font-size: 14px;
        line-height: 25px;
        vertical-align: center;
        border: 1px solid #000000;
        background-color: #000000;
        color: #fff;
        border-radius: 3px;
    }
    .btn:hover {
        border: 1px solid #000000;
        background-color: #000000;
    }
    .btn input{
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
    }
</style>
<!-- Body -->
<body>
<a th:href="@{/index}">
    <h1 class="text-primary" style="padding-top: 45px;padding-bottom: 47px;color: #ffffff">洗衣店智能服务系统</h1>
</a>
<div class="containerw3layouts-agileits">
    <div class="w3imageaits">
        <form th:action="@{/user/uploadPicture}" method="post" enctype="multipart/form-data">
            <img class="user" id="small_img" th:if="${session.head_portrait != null}" th:src="${session.head_portrait}" style="width: 100px;height: 100px;border-radius: 50%;margin-left: 149px;margin-right: 149px;margin-bottom: 20px;">
            <img class="user" id="img" th:if="${session.head_portrait eq null}" th:src="@{/img/head_portrait/user2.png}" style="width: 100px;height: 100px;border-radius: 50%;margin-left: 149px;margin-right: 149px;margin-bottom: 20px;">
            <label type="button" class="btn">
                <span>修改头像</span>
                <input type="file" name="img" accept="image/*">
            </label>
            <button type="submit" class="btn">保存头像</button>
        </form>
        <h2 style="margin-top: 200px;">用户中心</h2>
        <p>可以编辑您的个人信息！</p>
    </div>

    <script type="text/javascript">
        var small_img = document.querySelector('input[name=img]');
        var img = document.querySelector('input[name=img]');
        small_imgs = document.querySelector('#small_img');
        imgs = document.querySelector('#img');
        if (small_img) {
            small_img.addEventListener('change', function () {
                var file = this.files[0];
                var reader = new FileReader();
                // 监听reader对象的的onload事件，当图片加载完成时，把base64编码賦值给预览图片
                reader.addEventListener("load", function () {
                    small_imgs.src = reader.result;
                }, false);
                // 调用reader.readAsDataURL()方法，把图片转成base64
                reader.readAsDataURL(file);
                $("img").eq(0).css("display", "block");
            }, false);
        }
        if (img) {
            img.addEventListener('change', function () {
                var file = this.files[0];
                var reader = new FileReader();
                // 监听reader对象的的onload事件，当图片加载完成时，把base64编码賦值给预览图片
                reader.addEventListener("load", function () {
                    imgs.src = reader.result;
                }, false);
                // 调用reader.readAsDataURL()方法，把图片转成base64
                reader.readAsDataURL(file);
                $("img").eq(1).css("display", "block");
            }, false);
        }
    </script>

    <div class="aitsloginwthree w3layouts agileits">
        <form th:action="@{/user/updateUserInfo}" method="post">
            <div class="form-floating mb-3" style="margin-left: 20px;">
                <input class="form-control" type="text" id="name" name="name" th:value="${session.name}" style="background: #ffffff;padding-bottom: 0px" th:placeholder="'用户名'">
                <label for="name" th:text="'用户名：'" style="padding-left: 0px"></label>
            </div>
            <div class="form-floating mb-3" style="margin-left: 20px;">
                <input class="form-control" type="text" id="account" name="account" th:value="${session.account}" style="background: #ffffff;padding-bottom: 0px" th:placeholder="'账号'">
                <label for="account" th:text="'用户铭牌：'" style="padding-left: 0px"></label>
            </div>
            <div class="form-floating mb-3" style="margin-left: 20px;">
                <input class="form-control" type="text" id="gender" style="background: #ffffff;" th:placeholder="'性别'" disabled>
                <label for="gender" th:text="'性别：'" style="padding-left: 0px;padding-top: 10px;font-size: 14px;color: #b0b1bd;"></label>
                <div class="cc-selector wthreeselector" style="position: absolute;right: 225px;top: 0px;width: 40px;height: 40px;margin-top: 10px;">
                    <input id="gender1" type="radio" name="gender" th:checked="${session.gender == '男'}" style="position: absolute" th:value="男">
                    <label class="drinkcard-cc visa" for="gender1">
                        <img th:src="@{/img/male2.png}" >
                    </label>
                </div>
                <div class="cc-selector wthreeselector" style="position: absolute;right: 125px;top: 0px;width: 40px;height: 40px;margin-top: 8px;">
                    <input id="gender2" type="radio" name="gender" th:checked="${session.gender == '女'}" style="position: absolute" th:value="女">
                    <label class="drinkcard-cc visa" for="gender2">
                        <img th:src="@{/img/female2.png}" >
                    </label>
                </div>
            </div>
            <div class="form-floating mb-3" style="margin-left: 20px;">
                <input class="form-control" type="text" id="phone" name="phone" th:value="${session.phone}" pattern="^1[3456789][0-9]{9}" style="background: #ffffff;padding-bottom: 0px" th:placeholder="'电话'">
                <label for="phone" th:text="'电话：[+86 xxx xxxx xxxx]'" style="padding-left: 0px"></label>
            </div>
            <div class="form-floating mb-3" style="margin-left: 20px;">
                <input class="form-control" type="text" id="password" name="password" th:value="${session.password}" pattern="[A-Za-z0-9.]{6,18}" style="background: #ffffff;padding-bottom: 0px" th:placeholder="'密码'">
                <label for="password" th:text="'密码：[长度6-18个字符,不包括特殊字符]'" style="padding-left: 0px"></label>
            </div>
            <div class="form-floating mb-3" style="margin-left: 20px;">
                <input class="form-control" type="text" id="user_type" name="user_type" th:value="${session.user_type}" style="background: #ffffff;padding-bottom: 0px" th:placeholder="'用户类型'" disabled>
                <label for="user_type" th:text="'用户类型：'" style="padding-left: 0px"></label>
            </div>
            <div class="form-floating mb-3" style="margin-left: 20px;">
                <input class="form-control" type="text" id="money" name="money" th:value="${session.user_money}" style="background: #ffffff;padding-bottom: 0px" th:placeholder="'余额'" disabled>
                <label for="money" th:text="'余额：'" style="padding-left: 0px"></label>
            </div>
            <div class="form-floating mb-3" style="margin-left: 20px;height: 60px;">
                <input class="form-control" type="text" id="recharge" name="recharge" oninput="value=value.replace(/^(0+)|[^\d]+/g,'')" style="background: #ffffff;padding-bottom: 0px" th:placeholder="'充值'">
                <label for="recharge" th:text="'充值：'" style="padding-left: 0px"></label>
                <a th:onclick="recharge([[${session.phone}]]);" style="background-color: #ea365b;position: relative;bottom: 50px;left: 115px;border-radius: 3px;cursor: pointer;">充值</a>
            </div>
            <div class="send-button wthree agileits">
                <input type="submit" value="修改">
                <button th:onclick="'deleteUserInfo();'" type="button" class="btn btn-primary m-2" style="width: 86px;height: 43px;border: 0px;background-color: #e91e63;">注销</button>
            </div>
        </form>
    </div>
    <script type="text/javascript">
        function recharge(phone){
            if (confirm("确认充值吗？")){
                $.ajax({
                    url: '/user/recharge',
                    dataType: 'json',
                    type: 'post',
                    contentType:'application/json;charset=utf-8',
                    data:JSON.stringify({
                        money:$("#recharge").val(),
                        phone:phone
                    }),
                    headers: {
                        "Authorization": window.localStorage.getItem('token')
                    },
                    success:function (data){
                       if (data || data.success()){
                           alert("充值成功！")
                           window.location.reload();
                       }else {
                           alert(data.msg)
                       }
                    }
                })
            }
        }
    </script>
    <script type="text/javascript">
        var phone=document.getElementById("phone").value;
        function deleteUserInfo() {
            if(confirm('确定注销账户吗?')){
                $.ajax({
                    type:'post',
                    url : '/user/deleteUserInfo?phone='+phone,
                    dataType: 'json',
                    headers: {
                        "Authorization": window.localStorage.getItem('token')
                    },
                    success: function (result) {
                        if (result && result.success) {
                            window.alert(result.payload);
                            window.location.href="/index";
                            // window.location.reload();
                        } else {
                            window.alert(result.msg)
                        }
                    }
                });
            }
        }
    </script>

    <div class="clear"></div>
</div>

<div class="w3lsfooteragileits">
    <p> &copy; Laundry intelligent service system. All Rights Reserved | Design by <a href="#" target="=_blank">Mr. Sun Yi</a>
    </p>
</div>

<script th:src="@{/js/jquery-3.1.1.js}" type="text/javascript"></script>
<script th:src="@{/js/jquery-ui.js}" type="text/javascript"></script>

</body>
<!-- //Body -->
</html>